package com.valerian.sharesong.converter.from

import android.net.Uri
import androidx.test.ext.junit.runners.AndroidJUnit4
import com.valerian.sharesong.converter.Track
import junit.framework.TestCase.assertEquals
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.test.runTest
import org.junit.Test
import org.junit.runner.RunWith

@RunWith(AndroidJUnit4::class)
internal class DeezerTest {

    @Test
    fun regex() {

        val REGEX = "https://www\\.deezer\\.com/de/track/(\\d+)".toRegex()

        val match =
            REGEX.find("<!DOCTYPE html>\n" + "<html lang=\"de-DE\" class=\"no-js\" xmlns:fb=\"http://www.facebook.com/2008/fbml\">\n" + "  <head>\n" + "    <meta charset=\"utf-8\">\n" + "    <title>Bush - Heavy Is The Ocean: Mit Songtexten h&ouml;ren | Deezer</title>\n" + "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n" + "    <meta property=\"fb:app_id\" content=\"241284008322\">\n" + "    <meta property=\"og:site_name\" content=\"Deezer\">\n" + "\n" + "\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon.a6a53d55264841165a904dbea19d5d73.ico\"\n" + "      rel=\"shortcut icon\" type=\"image/x-icon\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon-16x16.526cde4edf20647be4ee32cdf35c1c13.png\"\n" + "      rel=\"icon\" sizes=\"16x16\" type=\"image/png\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon-32x32.42917d14a8cb0cc4045c827251b57c0e.png\"\n" + "      rel=\"icon\" sizes=\"32x32\" type=\"image/png\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon-48x48.92337504a99482504bbee02dce6997e1.png\"\n" + "      rel=\"icon\" sizes=\"48x48\" type=\"image/png\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon-96x96.852baf648e79894b668670e115e4a375.png\"\n" + "      rel=\"icon\" sizes=\"96x96\" type=\"image/png\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/favicon-256x256.37ca2d4f52f47137b0517b2da0d85eee.png\"\n" + "      rel=\"icon\" sizes=\"256x256\" type=\"image/png\">\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/images/common/favicon/apple-touch-icon.0faedc2a9ed312db04eb0361fb14a41a.png\"\n" + "      rel=\"apple-touch-icon\" sizes=\"180x180\">\n" + "\n" + "    <meta name=\"description\" content=\"Erstelle dein Deezer Konto und h&ouml;re\n" + "      Heavy Is The Ocean von Bush sowie 90 Millionen weitere Songs.\">\n" + "    <meta property=\"og:title\" content=\"Heavy Is The Ocean\">\n" + "    <meta property=\"og:description\" content=\"Bush - song - 2022\">\n" + "    <meta property=\"og:type\" content=\"music.song\">\n" + "    <meta property=\"og:image\"\n" + "      content=\"https://cdns-images.dzcdn.net/images/cover/01eefb6a28c8e0a21ddc002e54e28304/500x500.jpg\">\n" + "    <meta property=\"og:url\"\n" + "      content=\"https://www.deezer.com/de/track/1906165537\">\n" + "    <meta property=\"og:audio:type\" content=\"audio/vnd.facebook.bridge\">\n" + "    <meta property=\"music:musician\"\n" + "      content=\"https://www.deezer.com/de/artist/1551\">\n" + "    <meta property=\"og:audio\"\n" + "      content=\"https://cdns-preview-2.dzcdn.net/stream/c-2dce5a23856b0f88d72dcc4ce9dc778d-3.mp3\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"AD\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"AN\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"AW\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"AX\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"BL\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"BM\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"BS\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"BY\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"BZ\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"CN\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"CU\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"FO\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GF\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GG\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GI\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GL\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GP\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"GY\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"HT\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"IM\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"IR\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"JE\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"KP\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"LI\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"MC\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"MF\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"MO\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"MQ\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"NC\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"PF\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"PM\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"PR\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"RE\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"RU\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"SH\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"SM\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"SR\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"SY\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"TF\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"TT\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"UM\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"VA\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"WF\">\n" + "    <meta property=\"og:restrictions:country:disallowed\" content=\"YT\">\n" + "    <meta property=\"music:album:url\"\n" + "      content=\"https://www.deezer.com/de/album/354952407\">\n" + "    <meta property=\"music:preview_url:url\"\n" + "      content=\"https://cdns-preview-2.dzcdn.net/stream/c-2dce5a23856b0f88d72dcc4ce9dc778d-3.mp3\">\n" + "    <meta property=\"music:preview_url:secure_url\"\n" + "      content=\"https://cdns-preview-2.dzcdn.net/stream/c-2dce5a23856b0f88d72dcc4ce9dc778d-3.mp3\">\n" + "    <meta property=\"music:preview_url:type\" content=\"audio/mp3\">\n" + "    <meta property=\"music:album:disc\" content=\"1\">\n" + "    <meta property=\"music:album:track\" content=\"1\">\n" + "    <meta property=\"music:duration\" content=\"312\">\n" + "    <meta name=\"twitter:card\" content=\"summary\">\n" + "    <meta name=\"twitter:site\" content=\"@Deezer\">\n" + "    <meta name=\"twitter:title\" content=\"Heavy Is The Ocean\">\n" + "    <meta name=\"twitter:creator\" content=\"Bush\">\n" + "    <meta name=\"twitter:description\" content=\"Bush\">\n" + "    <meta name=\"twitter:image\"\n" + "      content=\"https://cdns-images.dzcdn.net/images/cover/01eefb6a28c8e0a21ddc002e54e28304/1000x1000.jpg\">\n" + "    <meta name=\"twitter:url\"\n" + "      content=\"https://www.deezer.com/de/track/1906165537\">\n" + "    <meta name=\"twitter:player:width\" content=\"500\">\n" + "    <meta name=\"twitter:player:height\" content=\"500\">\n" + "    <meta name=\"twitter:player\"\n" + "      content=\"https://widget.deezer.com/widget/dark/track/1906165537?app_id=457142&amp;tracklist=false&amp;radius=false\">\n" + "    <meta name=\"twitter:audio:partner\" content=\"Deezer\">\n" + "    <meta name=\"twitter:audio:source\"\n" + "      content=\"https://www.deezer.com/twitter/audio-card/track-1906165537-info\">\n" + "    <meta name=\"twitter:audio:artist_name\" content=\"Bush\">\n" + "    <meta name=\"twitter:app:name:iphone\" content=\"Deezer\">\n" + "    <meta name=\"twitter:app:id:iphone\" content=\"id292738169\">\n" + "    <meta name=\"twitter:app:url:iphone\"\n" + "      content=\"deezer://www.deezer.com/track/1906165537\">\n" + "    <meta property=\"al:ios:app_name\" content=\"Deezer\">\n" + "    <meta property=\"al:ios:app_store_id\" content=\"292738169\">\n" + "    <meta property=\"al:ios:url\"\n" + "      content=\"deezer://www.deezer.com/track/1906165537\">\n" + "    <meta name=\"twitter:app:name:ipad\" content=\"Deezer\">\n" + "    <meta name=\"twitter:app:id:ipad\" content=\"id292738169\">\n" + "    <meta name=\"twitter:app:url:ipad\"\n" + "      content=\"deezer://www.deezer.com/track/1906165537\">\n" + "    <meta name=\"twitter:app:name:googleplay\" content=\"Deezer\">\n" + "    <meta name=\"twitter:app:id:googleplay\" content=\"deezer.android.app\">\n" + "    <meta name=\"twitter:app:url:googleplay\"\n" + "      content=\"deezer://www.deezer.com/track/1906165537\">\n" + "    <meta property=\"al:android:app_name\" content=\"Deezer\">\n" + "    <meta property=\"al:android:package\" content=\"deezer.android.app\">\n" + "    <meta property=\"al:android:url\"\n" + "      content=\"deezer://www.deezer.com/track/1906165537\">\n" + "\n" + "    <link rel=\"chrome-webstore-item\"\n" + "      href=\"https://chrome.google.com/webstore/detail/npfkoakaabdallkcdbpkkhfilkkngakh\">\n" + "    <link rel=\"search\" type=\"application/opensearchdescription+xml\"\n" + "      href=\"https://e-cdn-files.dzcdn.net/xml/opensearch.xml\"\n" + "      title=\"Deezer.com\">\n" + "    <link rel=\"canonical\" href=\"https://www.deezer.com/de/track/1906165537\">\n" + "    <link rel=\"alternate\" hreflang=\"en\"\n" + "      href=\"https://www.deezer.com/en/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"fr\"\n" + "      href=\"https://www.deezer.com/fr/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"de\"\n" + "      href=\"https://www.deezer.com/de/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"es-ES\"\n" + "      href=\"https://www.deezer.com/es/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"it\"\n" + "      href=\"https://www.deezer.com/it/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"nl\"\n" + "      href=\"https://www.deezer.com/nl/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"pt\"\n" + "      href=\"https://www.deezer.com/pt/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"ru\"\n" + "      href=\"https://www.deezer.com/ru/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"pt-BR\"\n" + "      href=\"https://www.deezer.com/br/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"pl\"\n" + "      href=\"https://www.deezer.com/pl/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"tr\"\n" + "      href=\"https://www.deezer.com/tr/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"ro\"\n" + "      href=\"https://www.deezer.com/ro/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"hu\"\n" + "      href=\"https://www.deezer.com/hu/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"sr\"\n" + "      href=\"https://www.deezer.com/sr/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"ar\"\n" + "      href=\"https://www.deezer.com/ar/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"hr\"\n" + "      href=\"https://www.deezer.com/hr/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"es\"\n" + "      href=\"https://www.deezer.com/mx/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"cs\"\n" + "      href=\"https://www.deezer.com/cs/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"sk\"\n" + "      href=\"https://www.deezer.com/sk/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"sv\"\n" + "      href=\"https://www.deezer.com/sv/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"en-US\"\n" + "      href=\"https://www.deezer.com/us/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"ja-JP\"\n" + "      href=\"https://www.deezer.com/ja/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"bg\"\n" + "      href=\"https://www.deezer.com/bg/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"da\"\n" + "      href=\"https://www.deezer.com/da/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"fi\"\n" + "      href=\"https://www.deezer.com/fi/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"sl\"\n" + "      href=\"https://www.deezer.com/sl/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"uk\"\n" + "      href=\"https://www.deezer.com/uk/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <link rel=\"alternate\" hreflang=\"x-default\"\n" + "      href=\"https://www.deezer.com/en/track/1906165537?utm_campaign=clipboard-generic&amp;utm_source=user_sharing&amp;utm_content=track-1906165537&amp;deferredFl=1\">\n" + "    <!--[if gte IE 9]>\n" + "\t<meta name=\"application-name\" content=\"Deezer\">\n" + "\t<meta name=\"msapplication-tooltip\" content=\"Die Deezer App starten\">\n" + "\t<meta name=\"msapplication-window\" content=\"width=1600;height=1200\">\n" + "\t<meta name=\"msapplication-starturl\" content=\"http://www.deezer.com/de/\">\n" + "\t<meta name=\"msapplication-navbutton-color\" content=\"#202020\">\n" + "\t<![endif]-->\n" + "    <link\n" + "      href=\"https://e-cdn-files.dzcdn.net/cache/css/sass_c/app-web.aea805b5cac4a3411016.css\"\n" + "      rel=\"stylesheet\" type=\"text/css\">\n" + "    <script>\n" + "if (window.self === window.top) {\n" + "\tdocument.domain = 'deezer.com';\n" + "}\n" + "</script>\n" + "    <script\n" + "      src=\"https://e-cdn-files.dzcdn.net/cache/js/runtime.9066755523a92eb4a2dc.js\"></script>\n" + "    <script\n" + "      src=\"https://e-cdn-files.dzcdn.net/cache/js/legacy.d5218b4a64bd5efc7776.js\"></script>\n" + "    <script\n" + "      src=\"https://e-cdn-files.dzcdn.net/cache/js/bocal-de-DE.954fc325eac059b75f6d.js\"\n" + "      defer=\"true\"></script>\n" + "    <script\n" + "      src=\"https://e-cdn-files.dzcdn.net/cache/js/app-web.faa1b39d5bf13d26720e.js\"\n" + "      defer=\"true\"></script>\n" + "\n" + "  </head>\n" + "  <body class=\"dir-ltr\">\n" + "    <div id=\"dzr-app\">\n" + "      <div class=\"hidden\" id=\"naboo_content\">\n" + "        <div data-seo=\"naboo/track\">\n" + "          <div id=\"naboo_track\" class=\"naboo-display-seo\" itemscope\n" + "            itemtype=\"http://schema.org/MusicRecording\"\n" + "            itemid=\"/de/track/1906165537\">\n" + "            <meta itemprop=\"url\"\n" + "              content=\"https://www.deezer.com/de/track/1906165537\" />\n" + "\n" + "            <div id=\"naboo_track_head\" class=\"naboo-head\">\n" + "              <div id=\"naboo_track_head_cover\">\n" + "                <div class=\"table\">\n" + "                  <div class=\"head-content infos cell\">\n" + "                    <h1 id=\"naboo_track_title\" class=\"heading-1\">\n" + "                      <a class=\"link-gray-light\" href=\"/de/track/1906165537\">\n" + "                        <span itemprop=\"name\">Heavy Is The Ocean</span>\n" + "                      </a>\n" + "                    </h1>\n" + "                    <div class=\"clearfix\"></div>\n" + "                    <div class=\"naboo_track_song head-informations\"\n" + "                      itemprop=\"potentialAction\" itemscope\n" + "                      itemtype=\"http://schema.org/ListenAction\">\n" + "                      <div itemprop=\"target\" itemscope\n" + "                        itemtype=\"http://schema.org/EntryPoint\">\n" + "                        <meta itemprop=\"urlTemplate\"\n" + "                          content=\"https://www.deezer.com/de/track/1906165537?autoplay=true\"\n" + "                          />\n" + "                        <meta itemprop=\"actionPlatform\"\n" + "                          content=\"http://schema.org/DesktopWebPlatform\" />\n" + "                        <meta itemprop=\"actionPlatform\"\n" + "                          content=\"http://schema.org/AndroidPlatform\" />\n" + "                        <meta itemprop=\"actionPlatform\"\n" + "                          content=\"http://schema.googleapis.com/GoogleAudioCast\"\n" + "                          />")
                ?.value

        assertEquals("https://www.deezer.com/de/track/1906165537", match)
    }

    @OptIn(ExperimentalCoroutinesApi::class)
    @Test
    fun run() = runTest {
        val track = Deezer().getTrack(Uri.parse("https://deezer.page.link/6fLgXY55ZoCVP1Hq7"))

        assertEquals(Track("Heavy Is The Ocean", "Bush"), track)
    }
}